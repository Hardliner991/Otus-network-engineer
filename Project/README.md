### Проектирование мультисайтовой архитектуры с использованием EVPN-VXLAN
### Цель
Создание масштабируемой, отказоустойчивой и гибкой сети, объединяющей несколько дата-центров (например, два ЦОДа в разных городах), с поддержкой единых L2/L3 доменов, миграции виртуальных машин, балансировки нагрузки и автоматизации.

### 1. Основные компоненты
### A. EVPN (Ethernet VPN)

Контрольная плоскость , использующая BGP для обмена маршрутами между коммутаторами (VTEP).
Поддерживает многопоточность , маршрутизацию L2/L3 , интеграцию с VRF и оптимизацию BUM-трафика (Broadcast, Unknown Unicast, Multicast) .

### B. VXLAN (Virtual Extensible LAN)

Туннелирование , позволяющее расширять L2-сети между ЦОДами через IP-инфраструктуру.
Использует VNI (VXLAN Network Identifier) для изоляции трафика между виртуальными сетями.

### C. Spine-Leaf архитектура

Каждый ЦОД строится по схеме spine-leaf , где:

Spine — ядерные коммутаторы, отвечающие за маршрутизацию между leaf-узлами.
Leaf — граничные коммутаторы, подключающие серверы и обеспечивающие VXLAN-туннели.

### D. WAN/MPLS
Соединение между ЦОДами через WAN-сеть (например, Dark Fiber, DWDM) или MPLS .
Настройка IPsec-туннелей для безопасности.

### 2. Топология и логическая схема

[ЦОД 1]                [WAN/MPLS]                [ЦОД 2]
   |                        |                        |
[Spine 1] -- [Leaf 1] --- (Internet) --- [Leaf 3] -- [Spine 3]
   |                        |                        |
[Spine 2] -- [Leaf 2]     (EVPN-VXLAN)    [Leaf 4] -- [Spine 4]
   |                        |                        |
[Серверы]               [Маршруты BGP]          [Серверы]

### 3. Ключевые аспекты проектирования
### A. Мультисайтовое соединение через EVPN Type-5
Type-5 маршруты (IP Prefix routes) используются для маршрутизации между ЦОДами.
Пример: Подсеть 192.168.10.0/24 в ЦОД1 анонсируется в ЦОД2 через BGP EVPN.

### B. Настройка Route Reflectors (RR)
В каждом ЦОДе размещается Route Reflector для упрощения обмена маршрутами BGP.
RR в ЦОД1 и RR в ЦОД2 обмениваются маршрутами через eBGP.

### C. Route Targets (RT) для изоляции трафика
RT определяют, какие маршруты должны быть импортированы/экспортированы между VRF.

### D. Обработка BUM-трафика
Ingress Replication : Каждый Leaf отправляет копии пакетов всем удаленным VTEP.
PIM (Protocol Independent Multicast) : Используется для оптимизации multicast-трафика.
Optimized BUM (OB) : Современный подход, сочетающий ingress replication и PIM.
### E. Отказоустойчивость
Redundant VTEP : Каждый сервер подключается к двум Leaf-коммутаторам (vPC или MLAG).
Anycast GW : Шлюзы в каждом ЦОДе имеют один IP-адрес, обеспечивая бесперебойную маршрутизацию.









